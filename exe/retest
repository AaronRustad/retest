#!/usr/bin/env ruby

require 'retest'
require 'listen'

puts "Launching Retest..."

IGNORE_REGEX = /node_modules|tmp|\.sqlite|\.byebug_history/
command = Retest::Command.for(ARGV.join)

listener = Listen.to('.', ignore: IGNORE_REGEX, relative: true) do |modified, added, removed|
  if modified.any?
    system("clear") || system("cls")
    command.run(modified.first.strip)
  end
rescue => e
  puts "Something went wrong: #{e.message}"
end

listener.start # not blocking
puts "Ready to refactor! You can make file changes now"
sleep
